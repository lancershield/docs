# Gas Token Exploitation

```YAML

id: TBA
title: Gas Token Exploitation 
severity: M
category: gas-economics
language: solidity
blockchain: [ethereum]
impact: Attacker can manipulate transaction gas refunds to gain economic advantage
status: draft
complexity: medium
attack_vector: external
mitigation_difficulty: medium
versions: [">=0.6.0", "<0.9.0"]
cwe: CWE-770
swc: SWC-135

```

## üìù Description

- Gas token exploitation occurs when an attacker uses gas tokens (e.g., [GST2](https://gastoken.io), [CHI](https://1inch.io/blog/posts/chi-token/)) to:
- Reduce the effective cost of executing transactions by leveraging gas refunds,
- Incentivize arbitrage or spam transactions in economic-critical functions,Abuse refund logic in protocols that rely on `selfdestruct()` or SSTORE gas refunds.
- Although gas tokens have been mostly deprecated (and refunds were limited in [EIP-3529](https://eips.ethereum.org/EIPS/eip-3529)), their usage can still lead to:
- Block-level MEV manipulation,Artificially cheap execution of reentrant or arbitrage transactions,Denial-of-service if refund logic breaks block gas assumptions.

## üö® Vulnerable Code

```solidity
contract RefundVault {
    function clearStorage() external {
        delete userData[msg.sender]; // ‚ùå May grant attacker large gas refund
    }
}

```

## üß™ Exploit Scenario

Step-by-step attack:

1. Attacker deploys and pre-mints gas tokens (e.g., GST2).
2. During a high gas price opportunity (e.g., arbitrage window), attacker burns gas tokens to lower effective transaction cost.
3. They call an arbitrage/mint function with reduced gas cost, executing faster or cheaper than other bots.
4. In protocols that refund gas via selfdestruct or SSTORE, they profit at the expense of honest users or manipulate incentives.

**Assumptions:**

- Attacker loops through refund-heavy functions (e.g., clearing mappings), gaining economic advantage at protocol cost.

## ‚úÖ Fixed Code

```solidity

function safeClearStorage() external {
    require(gasleft() > 100000, "Not enough gas"); // ‚úÖ Prevent refund games
    delete userData[msg.sender];
}

```

## üõ°Ô∏è Prevention

### Primary Defenses

- Avoid refund-based gas logic or incentives in critical functions.
- Use Solidity >=0.8.6 and ensure contracts do not depend on gas refunds for functionality or economics.
- Disallow usage of known gas tokens via CALLCODE, SELFDESTRUCT, or by detecting known gas token contracts.

### Additional Safeguards

- Implement transaction reentrancy throttling to limit spam enabled by cheap gas.
- Monitor block-level gas refund spikes that may indicate refund-based attack vectors.

### Detection Methods

- Slither: gas-refund-abuse, sstore-refund-dependency, selfdestruct-refund detectors.
- Mempool analysis of high-gas but low-cost transactions using CHI/GST2 patterns.
- Static analysis of refund-prone patterns (delete, selfdestruct, repetitive SSTORE).

## üï∞Ô∏è Historical Incidents

- **Name:** CHI Token Arbitrage via 1inch 
- **Date:** 2020 
- **Impact:** CHI allowed gas refund abuse and led to unfair transaction costs 
- **Post-mortem:** [Link](https://1inch.io/blog/posts/chi-token/) 



## üìö Further Reading

- [SWC-135: Unexpected Behavior or Side Effects](https://swcregistry.io/docs/SWC-135) 
- [EIP-3529: Reduction in Refunds](https://eips.ethereum.org/EIPS/eip-3529) 
- [Gas Token Analysis](https://docs.flashbots.net/flashbots-auction/advanced/mev-gas-token/) 


---
## ‚úÖ Vulnerability Report


```markdown
id: TBA
title: Gas Token Exploitation 
severity: M
score:
impact: 3         
exploitability: 4 
reachability: 4   
complexity: 3     
detectability: 5  
finalScore: 3.6

```



---

## üìÑ Justifications & Analysis

- **Impact**: Moderate ‚Äî attacker gains execution edge, not direct fund theft.
- **Exploitability**: High before EIP-3529; still feasible in legacy chains or contracts.
- **Reachability**: Found in many refund-based designs or older token implementations.
- **Complexity**: Requires moderate knowledge and setup (gas tokens or contracts).
- **Detectability**: High ‚Äî static and runtime tools can identify suspicious gas refund patterns.