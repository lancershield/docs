# ERC2981 Royalty Bypass

```YAML
id: TBA
title: ERC2981 Royalty Bypass
severity: M
category: standard-violation
language: solidity
blockchain: [ethereum, polygon, arbitrum, bsc, optimism]
impact: Artists and creators do not receive expected royalties
status: draft
complexity: medium
attack_vector: external
mitigation_difficulty: medium
versions: [">=0.8.0", "<=0.8.25"]
cwe: CWE-284
swc: SWC-114
```

## ðŸ“ Description

- ERC2981 is a royalty standard for NFTs that allows creators to define how much royalty they should receive upon secondary sales. However, the standard only signals intentâ€”it does not enforce payments on-chain.
- This opens the door to royalty bypass exploits, where:
- Marketplaces intentionally ignore or disable royalty enforcement
- Users trade NFTs via direct transferFrom or P2P swaps, avoiding royalty payment
- Protocols omit calls to royaltyInfo() or fail to forward payments manually

## ðŸš¨ Vulnerable Code

```solidity

// Standard ERC2981 usage in NFT
function royaltyInfo(uint256 tokenId, uint256 salePrice) external view override returns (address receiver, uint256 royaltyAmount) {
    return (creator, salePrice * 500 / 10000); // 5% royalty
}
```

## ðŸ§ª Exploit Scenario

Step-by-step exploit process:

1. A user purchases an NFT from Collection X on a compliant marketplace (e.g., OpenSea) with 5% royalty.
2. The creator receives 5% of each secondary sale initially.
3. Later, users switch to a marketplace or OTC swap tool that does not implement ERC2981 logic.
4. Sales are conducted using transferFrom() without routing through royaltyInfo() or paying out royalties.

**Assumptions:**

- The NFT contract implements ERC2981 correctly.
- The sale is conducted through a third-party that does not call royaltyInfo() or send payments accordingly.

## âœ… Fixed Code

```solidity

modifier onlyRoyaltyCompliant(address operator) {
    require(approvedRoyaltyMarketplaces[operator], "Royalty bypass detected");
    _;
}

// Or override transfer
function transferFrom(address from, address to, uint256 tokenId) public override {
    require(msg.sender == address(royaltyEnforcer), "Use royalty-compliant route");
    super.transferFrom(from, to, tokenId);
}
```

## ðŸ›¡ï¸ Prevention

### Primary Defenses

- Deploy ERC2981 with trusted enforcement contracts or royalty forwarders.
- Use operator filtering (e.g., OpenSeaâ€™s OperatorFilterer or Manifold) to block non-compliant marketplaces.
- Consider L2-native enforced royalties (e.g., Zora, Sound.xyz, BASE-native NFTs)

### Additional Safeguards

- Blacklist non-compliant marketplaces via operatorRestrictions.
- Incentivize buyers/sellers to use royalty-friendly protocols through in-app rewards.
- Educate users about the impact of royalty evasion on creators.

### Detection Methods

- Monitor sales volume on non-compliant platforms (e.g., Sudoswap, Blur v1).
- Compare royaltyInfo() expectations vs actual on-chain transfers.
- Tools: Manifold Royalty Registry, Etherscan API, custom transfer hooks

## ðŸ•°ï¸ Historical Exploits

- **Name:** Blur.io Royalty Optional Model 
- **Date:** 2023 
- **Loss:** Estimated $10M+ in bypassed creator fees 
- **Post-mortem:** [Link to post-mortem](https://decrypt.co/) 
  
## ðŸ“š Further Reading

- [EIP-2981: NFT Royalty Standard](https://eips.ethereum.org/EIPS/eip-2981) 
- [Manifold â€“ Royalty Registry](https://royaltyregistry.xyz/)
- [NFTNow â€“ Royalty War Explained](https://nftnow.com/)

--- 

## âœ… Vulnerability Report

```markdown
id: TBA
title: ERC2981 Royalty Bypass
severity: M
score:
impact: 3  
exploitability: 4  
reachability: 4  
complexity: 2  
detectability: 3  
finalScore: 3.35
```

---

## ðŸ“„ Justifications & Analysis

- **Impact**: Financial loss for creators over time, breaking trust in NFT secondary markets.
- **Exploitability**: Requires nothing more than routing transfers outside royalty-respecting platforms.
- **Reachability**: All NFTs with ERC2981 and no enforcement mechanism are affected.
- **Complexity**: Lowâ€”any contract or EOA can skip royalty logic.
- **Detectability**: Mediumâ€”only visible via off-chain analysis or monitoring platforms.
